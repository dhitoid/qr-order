<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dhito Cafe - Sistem Kasir</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif}

body{
background:linear-gradient(135deg,#0f172a,#1e293b);
color:white;
padding:20px;
overflow-x:hidden;
}

/* ================= SIDEBAR ================= */

.sidebar{
position:fixed;
top:0;
left:-260px;
width:240px;
height:100%;
background:rgba(255,255,255,0.06);
backdrop-filter:blur(25px);
padding:20px;
transition:.35s cubic-bezier(.77,0,.18,1);
z-index:9999;
box-shadow:20px 0 40px rgba(0,0,0,.5);
}

.sidebar.active{
left:0;
}

.sidebar h3{
margin-bottom:20px;
}

.sidebar a{
display:block;
padding:12px;
border-radius:14px;
text-decoration:none;
color:white;
font-size:13px;
margin-bottom:10px;
background:rgba(255,255,255,0.05);
transition:.25s;
}

.sidebar a:hover{
background:#3b82f6;
transform:translateX(5px);
}

/* overlay */
.overlay{
position:fixed;
inset:0;
background:rgba(0,0,0,.5);
backdrop-filter:blur(4px);
opacity:0;
pointer-events:none;
transition:.3s;
}

.overlay.active{
opacity:1;
pointer-events:auto;
}

/* ================= HEADER ================= */

.header{
display:flex;
flex-direction:column;
gap:15px;
margin-bottom:20px;
}

.header-top{
display:flex;
justify-content:space-between;
align-items:center;
}

.menu-btn{
font-size:20px;
cursor:pointer;
background:rgba(255,255,255,0.1);
padding:8px 14px;
border-radius:12px;
}

.header h2{font-size:18px}

#searchInput{
width:100%;
max-width:500px;
padding:14px 18px;
border-radius:18px;
border:none;
outline:none;
font-size:14px;
background:rgba(255,255,255,0.08);
backdrop-filter:blur(20px);
color:#fff;
}

/* ================= FILTER ================= */

.filter-group{
display:flex;
flex-wrap:wrap;
gap:10px;
margin-bottom:10px;
}

.filter-group button{
padding:8px 14px;
border:none;
border-radius:20px;
background:rgba(255,255,255,0.1);
color:white;
cursor:pointer;
font-size:12px;
}

.filter-group button.active{
background:#4CAF50;
}

/* ================= ORDER ================= */

.orders{
display:grid;
gap:15px;
}

.order-card{
background:rgba(255,255,255,0.05);
padding:16px;
border-radius:18px;
backdrop-filter:blur(12px);
transition:.3s;
}

.order-card:hover{
transform:translateY(-3px);
}

.badge{
display:inline-block;
padding:4px 10px;
border-radius:20px;
font-size:12px;
margin-top:6px;
margin-right:6px;
}

.waiting{background:#f59e0b33;color:#fbbf24}
.process{background:#3b82f633;color:#60a5fa}
.done{background:#10b98133;color:#34d399}
.unpaid{background:#ef444433;color:#f87171}
.paid{background:#22c55e33;color:#4ade80}

.actions{
margin-top:10px;
display:flex;
gap:8px;
flex-wrap:wrap;
}

.actions button{
padding:6px 10px;
border:none;
border-radius:12px;
cursor:pointer;
font-size:12px;
}

.btn-primary{background:#4CAF50;color:white}
.btn-warning{background:#f59e0b;color:black}
.btn-danger{background:#ef4444;color:white}
.btn-info{background:#3b82f6;color:white}

.empty{
opacity:.5;
text-align:center;
margin-top:50px;
}
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
<h3>â˜• Dhito Cafe</h3>
<a href="kasir.html">ðŸ§¾ Kasir</a>
<a href="statistik.html">ðŸ“Š Statistik</a>
<a href="#">âž• Manual Order (Soon)</a>
</div>

<div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

<div class="header">
<div class="header-top">
<div style="display:flex;align-items:center;gap:10px;">
<div class="menu-btn" onclick="toggleSidebar()">â˜°</div>
<h2>Kasir</h2>
</div>
<div id="totalOrders"></div>
</div>

<input type="text" id="searchInput"
placeholder="Cari nama / no hp / order id..."
oninput="handleSearch()">
</div>

<div class="filter-group" id="methodFilter">
<button onclick="setMethod('ALL',this)" class="active">Semua Metode</button>
<button onclick="setMethod('QRIS',this)">QRIS</button>
<button onclick="setMethod('KASIR',this)">Kasir</button>
</div>

<div class="filter-group" id="statusFilter">
<button onclick="setStatus('ALL',this)" class="active">Semua Status</button>
<button onclick="setStatus('Menunggu',this)">Menunggu</button>
<button onclick="setStatus('Diproses',this)">Diproses</button>
<button onclick="setStatus('Selesai',this)">Selesai</button>
</div>

<div class="filter-group" id="paymentFilter">
<button onclick="setPayment('ALL',this)" class="active">Semua Pembayaran</button>
<button onclick="setPayment('Lunas',this)">Lunas</button>
<button onclick="setPayment('Belum Lunas',this)">Belum Lunas</button>
</div>

<div style="margin:20px 0;padding:15px;background:rgba(255,255,255,0.05);border-radius:16px;">
<h3 style="margin-bottom:10px;">âž• Manual Order</h3>

<div id="manualMenu" style="display:grid;gap:10px;"></div>

<button onclick="createManualOrder()"
style="margin-top:10px;background:#4CAF50;padding:10px;border:none;border-radius:12px;color:white;">
Buat Order
</button>
</div>

<div class="orders" id="orders"></div>

<script>

/* ================= SIDEBAR ================= */
function toggleSidebar(){
document.getElementById("sidebar").classList.toggle("active");
document.getElementById("overlay").classList.toggle("active");
}

/* ================= MENU DATA ================= */

const kasirMenu=[
{nama:"Nasi Goreng",harga:25000,kategori:"makanan"},
{nama:"Es Kopi",harga:18000,kategori:"minuman"},
{nama:"Kentang",harga:15000,kategori:"cemilan"},
{nama:"Paket Hemat",harga:45000,kategori:"promo"}
];

/* ================= CART ================= */

let cartKasir=[];

/* ================= STORAGE ================= */

function getOrders(){
return JSON.parse(localStorage.getItem("order_history")||"[]");
}

function saveOrders(data){
localStorage.setItem("order_history",JSON.stringify(data));
}

/* ================= FILTER STATE ================= */

let methodFilter="ALL";
let statusFilter="ALL";
let paymentFilter="ALL";
let searchKeyword="";

/* ================= SEARCH ================= */

function handleSearch(){
searchKeyword=document.getElementById("searchInput")
.value.toLowerCase().trim();
renderOrders();
}

/* ================= UPDATE STATUS ================= */

function updateStatusById(id,status){
let orders=getOrders();
let order=orders.find(o=>o.id===id);
if(!order)return;

order.orderStatus=status;
saveOrders(orders);
renderOrders();
}

function markPaidById(id){
let orders=getOrders();
let order=orders.find(o=>o.id===id);
if(!order)return;

order.paymentStatus="Lunas";
order.orderStatus="Diproses";
saveOrders(orders);
renderOrders();
}

function deleteOrderById(id){
let orders=getOrders().filter(o=>o.id!==id);
saveOrders(orders);
renderOrders();
}

/* ================= RENDER ORDER ================= */

function renderOrders(){

let orders=getOrders().slice()
.sort((a,b)=>b.timestamp-a.timestamp);

if(methodFilter!=="ALL")
orders=orders.filter(o=>o.paymentMethod===methodFilter);

if(statusFilter!=="ALL")
orders=orders.filter(o=>o.orderStatus===statusFilter);

if(paymentFilter!=="ALL")
orders=orders.filter(o=>o.paymentStatus===paymentFilter);

if(searchKeyword){
orders=orders.filter(o=>
(o.customerName||"").toLowerCase().includes(searchKeyword)||
(o.customerPhone||"").toLowerCase().includes(searchKeyword)||
(o.id||"").toLowerCase().includes(searchKeyword)
);
}

document.getElementById("totalOrders")
.innerText="Total: "+orders.length+" order";

let container=document.getElementById("orders");

if(!orders.length){
container.innerHTML="<div class='empty'>Tidak ada data ditemukan</div>";
return;
}

container.innerHTML=orders.map(order=>{

let items=order.items.map(x=>
`${x.nama} (${x.qty}x)`
).join("<br>");

let paymentBadge=order.paymentStatus==="Lunas"?"paid":"unpaid";

let statusClass="waiting";
if(order.orderStatus==="Diproses")statusClass="process";
if(order.orderStatus==="Selesai")statusClass="done";

return `
<div class="order-card">
<div style="display:flex;justify-content:space-between;font-size:13px;opacity:.8;">
<span>${order.id}</span>
<span>${order.date}</span>
</div>

<div style="margin:8px 0;font-size:13px;">
<strong>${order.customerName||"-"}</strong><br>
${order.customerPhone||"-"}
</div>

<div style="font-size:13px;">${items}</div>

<div style="font-weight:700;margin-top:8px;">
Rp ${order.total.toLocaleString()}
</div>

<div>
<span class="badge ${paymentBadge}">
${order.paymentStatus}
</span>

<span class="badge ${statusClass}">
${order.orderStatus}
</span>
</div>

<div class="actions">

<button class="btn-info"
onclick="updateStatusById('${order.id}','Diproses')">
Proses
</button>

<button class="btn-primary"
onclick="updateStatusById('${order.id}','Selesai')">
Selesai
</button>

${order.paymentMethod==="KASIR" && order.paymentStatus!=="Lunas"
? `<button class="btn-warning"
onclick="markPaidById('${order.id}')">
Tandai Lunas
</button>`:""}

<button class="btn-danger"
onclick="deleteOrderById('${order.id}')">
Hapus
</button>

</div>
</div>
`;

}).join("");
}

/* ================= MANUAL ORDER UI ================= */

function renderManualMenu(){

let container=document.getElementById("manualMenu");

container.innerHTML=kasirMenu.map(item=>`
<div style="background:rgba(255,255,255,0.07);
padding:12px;
border-radius:16px;
display:flex;
justify-content:space-between;
align-items:center;">

<div>
<div style="font-weight:600">${item.nama}</div>
<div style="font-size:12px;opacity:.6">
Rp ${item.harga.toLocaleString()}
</div>
</div>

<div style="display:flex;gap:6px;">
<button onclick="changeQty('${item.nama}',-1)">-</button>
<button onclick="changeQty('${item.nama}',1)">+</button>
</div>

</div>
`).join("");
}

function changeQty(nama,delta){

let item=kasirMenu.find(i=>i.nama===nama);
let existing=cartKasir.find(c=>c.nama===nama);

if(!existing && delta>0){
cartKasir.push({nama:item.nama,harga:item.harga,qty:1});
}else if(existing){
existing.qty+=delta;
if(existing.qty<=0)
cartKasir=cartKasir.filter(c=>c.nama!==nama);
}

renderCartPreview();
}

function renderCartPreview(){

let subtotal=0;
cartKasir.forEach(i=>subtotal+=i.harga*i.qty);

document.getElementById("manualMenu")
.insertAdjacentHTML("beforeend",
`<div style="margin-top:10px;font-size:12px;opacity:.7">
Subtotal: Rp ${subtotal.toLocaleString()}
</div>`);
}

/* ================= CREATE ORDER ================= */

function createManualOrder(){

if(cartKasir.length===0){
alert("Belum ada item");
return;
}

let subtotal=0;
cartKasir.forEach(i=>subtotal+=i.harga*i.qty);

let service=subtotal*0.05;
let tax=subtotal*0.10;
let total=subtotal+service+tax;

let orders=getOrders();

orders.unshift({
id:"#ORD-"+Date.now(),
date:new Date().toLocaleString(),
timestamp:Date.now(),
items:cartKasir,
subtotal,
service,
tax,
total,
paymentMethod:"KASIR",
paymentStatus:"Belum Lunas",
orderStatus:"Menunggu",
customerName:"Walk In",
customerPhone:"-"
});

saveOrders(orders);

cartKasir=[];
renderOrders();
renderManualMenu();

alert("Order berhasil dibuat");
}

/* ================= AUTO SYNC ================= */

window.addEventListener("storage",function(e){
if(e.key==="order_history") renderOrders();
});

/* INIT */
renderOrders();
renderManualMenu();

</script>

</body>
</html>