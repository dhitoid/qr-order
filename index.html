<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Manual Order - Dhito Cafe</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="menuorder.css">

</head>
<body>

<div class="dynamic-island" id="island">â˜• Manual Order</div>

<div class="hero">
  <div class="greeting">Mode Kasir</div>
  <div class="headline">Input Order Manual</div>
</div>

<div class="menu-grid" id="menu"></div>

<div class="floating-cart" onclick="openSheet()">
ðŸ›’
<div class="cart-count" id="cartCount">0</div>
</div>

<!-- SHEET SAMA SEPERTI INDEX -->
<div class="sheet" id="sheet">
<div class="handle"></div>

<h3>Detail Pesanan</h3>
<div id="cartItems"></div>

<div class="checkout-summary">
  <div class="summary-row">
    <span>Subtotal</span>
    <span id="subtotal"></span>
  </div>
  <div class="summary-row">
    <span>Service (5%)</span>
    <span id="service"></span>
  </div>
  <div class="summary-row">
    <span>Pajak (10%)</span>
    <span id="tax"></span>
  </div>
  <div class="summary-divider"></div>
  <div class="summary-row total-row">
    <span>Total</span>
    <span id="grandTotal"></span>
  </div>
</div>

<hr style="margin:15px 0;border-color:rgba(255,255,255,0.1)">

<h3>Pembayaran</h3>
<input class="input" id="customerName" placeholder="Nama">
<input class="input" id="phoneInput" placeholder="No HP (08xxxx)">
<select class="input" id="paymentMethod">
<option value="">Pilih Metode Pembayaran</option>
<option value="QRIS">QRIS</option>
<option value="KASIR">Bayar di Kasir</option>
</select>

<button class="checkout-btn" onclick="manualCheckout()">
Simpan ke Kasir
</button>

<br><br>
<button class="btn-secondary" onclick="window.location.href='kasir.html'">
â¬… Kembali ke Kasir
</button>

</div>

<!-- QRIS MODAL SAMA PERSIS INDEX -->
<div class="qris-modal" id="qrisModal">
  <div class="qris-content">
    <div class="modal-handle"></div>

    <div class="qris-header">
      <h3>Pembayaran QRIS</h3>
      <button class="close-btn" onclick="cancelQris()">âœ•</button>
    </div>

    <div class="qris-total" id="qrisTotal"></div>

    <div class="qris-box">
      <div class="qris-loading" id="qrisLoading">
        <div class="spinner"></div>
        <p>Menghasilkan QR...</p>
      </div>

      <img id="qrisImage" />

      <div class="qris-overlay-status" id="qrisOverlayStatus">
        Menunggu Pembayaran
      </div>
    </div>

    <div class="qris-timer">
      Berlaku <span id="qrisTimer">60</span> detik
    </div>

    <div class="qris-buttons">
      <button class="btn-secondary" onclick="cancelQris()">Batal</button>
      <button class="btn-primary" onclick="confirmManualPayment()">Konfirmasi Bayar</button>
    </div>
  </div>
</div>

<script src="daftarmenu.js"></script>
<script src="menuorder.js"></script>

<script>

/* ================= OVERRIDE CHECKOUT ================= */

function manualCheckout(){

if(cart.length === 0){
showNotification("Keranjang kosong");
return;
}

let method = document.getElementById("paymentMethod").value;
if(!method){
showNotification("Pilih metode pembayaran");
return;
}

if(method === "QRIS"){
openQrisModal();
return;
}

saveManualOrder("Lunas");

}

/* ================= SIMPAN KE KASIR ================= */

function saveManualOrder(status){

let subtotal = calculateSubtotal();
let service  = subtotal * 0.05;
let tax      = subtotal * 0.10;
let total    = subtotal + service + tax;

let orders = JSON.parse(localStorage.getItem("order_history") || "[]");

orders.unshift({
id:"#ORD-"+Date.now(),
date:new Date().toLocaleString(),
timestamp:Date.now(),
items:[...cart],
subtotal,
service,
tax,
total,
paymentMethod:document.getElementById("paymentMethod").value,
paymentStatus:status,
orderStatus:"Diproses",
customerName:document.getElementById("customerName").value || "Walk In",
customerPhone:document.getElementById("phoneInput").value || "-"
});

localStorage.setItem("order_history", JSON.stringify(orders));

cart = [];
updateCartUI();

closeSheet();
showNotification("Order masuk ke kasir");

}

/* ================= QRIS CONFIRM ================= */

function confirmManualPayment(){
saveManualOrder("Lunas");
closeQrisModal();
showNotification("Pembayaran berhasil");
}

</script>

</body>
</html>