<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dhito Cafe 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
--bg:#0b0f1a;
--card:rgba(255,255,255,0.05);
--glass:rgba(255,255,255,0.08);
--accent:#4f9cff;
--accent2:#7ab8ff;
--danger:#ff453a;
--radius:28px;
}

*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:'Inter',sans-serif;
}

body{
background:
radial-gradient(circle at 20% 0%,rgba(79,156,255,0.25),transparent 40%),
radial-gradient(circle at 80% 20%,rgba(122,184,255,0.15),transparent 40%),
linear-gradient(180deg,#0a0f1c,#0e1627);
color:white;
overflow-x:hidden;
padding-bottom:140px;
}

.menu-section{
margin-bottom:40px;
}

.section-title{
font-size:18px;
font-weight:700;
margin:0 20px 18px;
opacity:.8;
letter-spacing:.5px;
}

/* ================= DYNAMIC ISLAND 2026 ================= */
.dynamic-island{
position:fixed;
top:22px;
left:50%;
transform:translateX(-50%) scale(1);
padding:14px 26px;
border-radius:50px;
font-size:14px;
font-weight:600;
letter-spacing:.3px;

background:linear-gradient(145deg,rgba(255,255,255,0.08),rgba(255,255,255,0.03));
backdrop-filter:blur(40px);
border:1px solid rgba(255,255,255,0.12);

box-shadow:
0 8px 40px rgba(0,0,0,0.6),
0 0 30px rgba(79,156,255,0.25);

transition:all .6s cubic-bezier(.22,1,.36,1);
z-index:9999;
}

.dynamic-island.expand{
width:320px;
border-radius:32px;
transform:translateX(-50%) scale(1.05);
}

.island-badge{
background:var(--danger);
padding:5px 10px;
font-size:11px;
border-radius:20px;
margin-left:10px;
animation:pulse 1.2s infinite;
}

@keyframes pulse{
0%{transform:scale(1)}
50%{transform:scale(1.15)}
100%{transform:scale(1)}
}

/* ================= HEADER ================= */
.header{
text-align:center;
padding:110px 20px 40px;
font-size:32px;
font-weight:700;
background:linear-gradient(90deg,#fff,#9ecbff);
-webkit-background-clip:text;
-webkit-text-fill-color:transparent;
}

/* ================= CATEGORY ================= */
.categories{
position:sticky;
top:70px;
z-index:40;
background:linear-gradient(180deg,#0e1627,#0e1627dd);
backdrop-filter:blur(20px);
padding:15px 20px;
}

.categories button{
background:var(--glass);
border:1px solid rgba(255,255,255,0.08);
padding:10px 20px;
border-radius:30px;
color:rgba(255,255,255,0.7);
cursor:pointer;
transition:all .4s ease;
backdrop-filter:blur(20px);
}

.categories button.active{
background:linear-gradient(135deg,var(--accent),var(--accent2));
color:white;
box-shadow:0 0 20px rgba(79,156,255,0.5);
}

/* ================= MENU CARD ================= */
.menu-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(170px,1fr));
gap:22px;
padding:0 20px;
}

.card{
background:var(--card);
backdrop-filter:blur(30px);
border:1px solid rgba(255,255,255,0.08);
border-radius:26px;
padding:14px;
transition:all .4s cubic-bezier(.22,1,.36,1);
display:flex;
flex-direction:column;
justify-content:space-between;
}

.card h4{
font-size:15px;
margin-bottom:6px;
}

.card:hover{
transform:translateY(-8px) scale(1.03);
box-shadow:0 15px 40px rgba(79,156,255,0.25);
}

.card img{
width:100%;
height:130px;
object-fit:cover;
border-radius:20px;
margin-bottom:12px;
}

.price{
color:#9ecbff;
font-weight:600;
margin-bottom:12px;
}

.card button{
width:100%;
padding:12px;
border:none;
border-radius:20px;
background:linear-gradient(135deg,var(--accent),var(--accent2));
color:white;
font-weight:600;
cursor:pointer;
transition:.3s;
}

.card button:hover{
transform:scale(1.05);
}

/* ================= FLOATING CART ================= */
.floating-cart{
position:fixed;
right:22px;
bottom:24px;
width:65px;
height:65px;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-size:24px;
cursor:pointer;

background:linear-gradient(145deg,var(--accent),var(--accent2));
box-shadow:
0 15px 35px rgba(79,156,255,0.4),
0 0 25px rgba(79,156,255,0.3);

transition:all .4s ease;
}

.floating-cart:hover{
transform:scale(1.1);
}

.cart-count{
position:absolute;
top:-6px;
right:-6px;
background:var(--danger);
font-size:11px;
padding:5px 8px;
border-radius:20px;
}

/* ================= SHEET MODERN ================= */
.sheet{
position:fixed;
left:0;
right:0;
bottom:-100%;
height:85%;
background:rgba(17,26,43,0.95);
backdrop-filter:blur(50px);
border-top-left-radius:40px;
border-top-right-radius:40px;
transition:bottom .7s cubic-bezier(.22,1,.36,1);
padding:24px;
overflow-y:auto;
z-index:1000;
box-shadow:0 -20px 60px rgba(0,0,0,0.6);
}

.sheet.show{bottom:0;}

.sheet .handle{
width:60px;
height:6px;
background:rgba(255,255,255,0.3);
border-radius:20px;
margin:0 auto 20px;
}

.sheet h3{
font-size:18px;
margin-bottom:10px;
}

.cart-item{
display:flex;
justify-content:space-between;
align-items:center;
padding:12px 0;
border-bottom:1px solid rgba(255,255,255,0.08);
}

.cart-item-info{
display:flex;
flex-direction:column;
gap:4px;
}

.cart-item-name{
font-size:14px;
font-weight:600;
}

.cart-item-price{
font-size:12px;
opacity:.6;
}

.checkout-btn{
margin-top:20px;
width:100%;
padding:16px;
border:none;
border-radius:24px;
background:linear-gradient(135deg,var(--accent),var(--accent2));
color:white;
font-weight:600;
cursor:pointer;
transition:.4s;
}

.checkout-btn:hover{
transform:scale(1.04);
box-shadow:0 10px 30px rgba(79,156,255,0.4);
}

.input{
width:100%;
padding:15px;
border-radius:20px;
border:1px solid rgba(255,255,255,0.08);
margin-bottom:14px;
background:rgba(255,255,255,0.05);
color:white;
backdrop-filter:blur(20px);
}

/* === NOTIFICATION COLORS 2026 === */
.dynamic-island.success{
background:linear-gradient(135deg,#1db954,#1ed760);
box-shadow:0 0 30px rgba(30,215,96,0.4);
}

.dynamic-island.info{
background:linear-gradient(135deg,#4f9cff,#7ab8ff);
box-shadow:0 0 30px rgba(79,156,255,0.4);
}

.dynamic-island.danger{
background:linear-gradient(135deg,#ff3b30,#ff6b60);
box-shadow:0 0 30px rgba(255,59,48,0.4);
}

.dynamic-island.warning{
background:linear-gradient(135deg,#ff9f0a,#ffb340);
box-shadow:0 0 30px rgba(255,159,10,0.4);
}

/* === CHECKOUT PROGRESS ISLAND === */
.island-progress{
margin-top:8px;
height:6px;
background:rgba(255,255,255,0.2);
border-radius:10px;
overflow:hidden;
}

.island-progress-bar{
height:100%;
width:0%;
background:linear-gradient(90deg,#4f9cff,#7ab8ff);
transition:width .6s cubic-bezier(.22,1,.36,1);
}

.hero{
padding:120px 20px 40px;
text-align:left;
}

.greeting{
font-size:14px;
opacity:.6;
margin-bottom:8px;
}

.headline{
font-size:34px;
font-weight:700;
line-height:1.2;
background:linear-gradient(90deg,#fff,#9ecbff);
-webkit-background-clip:text;
-webkit-text-fill-color:transparent;
}

.badge{
position:absolute;
background:#1db954;
color:white;
font-size:10px;
padding:4px 8px;
border-radius:20px;
top:12px;
left:12px;
}

.badge.promo{
background:#ff453a;
}
.card{position:relative;}

.loyalty{
margin:20px;
}

.loyalty-text{
font-size:13px;
margin-bottom:6px;
opacity:.7;
}

.loyalty-bar{
height:8px;
background:rgba(255,255,255,0.1);
border-radius:20px;
overflow:hidden;
}

.loyalty-fill{
height:100%;
width:40%;
background:linear-gradient(90deg,#1db954,#1ed760);
transition:width .6s ease;
}

/* === PAYMENT STATES === */
.island-status{
font-size:13px;
opacity:.8;
margin-top:6px;
}

.island-progress{
margin-top:10px;
height:6px;
background:rgba(255,255,255,0.15);
border-radius:10px;
overflow:hidden;
}

.island-progress-bar{
height:100%;
width:0%;
background:linear-gradient(90deg,#1db954,#4f9cff);
transition:width .8s cubic-bezier(.22,1,.36,1);
}

.dynamic-island.payment{
background:linear-gradient(145deg,#1c2738,#0f1725);
border:1px solid rgba(255,255,255,0.15);
box-shadow:0 0 40px rgba(79,156,255,0.35);
}

/* === MENU MODAL PREMIUM === */
.menu-modal{
position:fixed;
inset:0;
background:rgba(0,0,0,0.6);
backdrop-filter:blur(20px);
display:flex;
align-items:flex-end;
justify-content:center;
opacity:0;
pointer-events:none;
transition:.4s ease;
z-index:2000;
}

.menu-modal.show{
opacity:1;
pointer-events:auto;
}

.menu-modal-content{
width:100%;
max-width:480px;
background:#0f1725;
border-top-left-radius:40px;
border-top-right-radius:40px;
overflow:hidden;
transform:translateY(100%);
transition:.6s cubic-bezier(.22,1,.36,1);
}

.menu-modal.show .menu-modal-content{
transform:translateY(0);
}

.menu-modal-img{
height:260px;
background-size:cover;
background-position:center;
}

.menu-modal-body{
padding:24px;
}

.menu-modal-body h2{
font-size:22px;
margin-bottom:10px;
}

.menu-modal-body p{
opacity:.7;
font-size:14px;
margin-bottom:16px;
line-height:1.5;
}

.modal-price{
font-weight:600;
color:#9ecbff;
margin-bottom:18px;
}

.modal-add{
width:100%;
padding:16px;
border:none;
border-radius:24px;
background:linear-gradient(135deg,#4f9cff,#7ab8ff);
color:white;
font-weight:600;
font-size:15px;
cursor:pointer;
transition:.3s;
}

.modal-add:hover{
transform:scale(1.04);
}

.topping-section{
margin-bottom:16px;
}

.topping-section h4{
font-size:14px;
opacity:.7;
margin-bottom:8px;
}

.topping-list{
display:flex;
flex-wrap:wrap;
gap:8px;
}

.topping-item{
padding:8px 12px;
border-radius:20px;
font-size:12px;
cursor:pointer;
background:#1f2937;
transition:.3s;
border:1px solid transparent;
}

.topping-item.active{
background:linear-gradient(135deg,#4f9cff,#7ab8ff);
color:white;
border:1px solid #7ab8ff;
}

.modal-qty{
display:flex;
align-items:center;
justify-content:center;
gap:20px;
margin-bottom:18px;
}

.modal-qty button{
width:42px;
height:42px;
border:none;
border-radius:50%;
font-size:20px;
font-weight:600;
cursor:pointer;
background:rgba(255,255,255,0.1);
color:white;
transition:.3s;
}

.modal-qty button:hover{
background:linear-gradient(135deg,var(--accent),var(--accent2));
}

.modal-qty span{
font-size:20px;
font-weight:600;
min-width:30px;
text-align:center;
}

.qty-control{
display:flex;
align-items:center;
gap:12px;
}

.qty-control button{
width:34px;
height:34px;
border:none;
border-radius:50%;
background:rgba(255,255,255,0.1);
color:white;
font-size:18px;
cursor:pointer;
transition:.3s;
}

.qty-control button:hover{
background:linear-gradient(135deg,var(--accent),var(--accent2));
}

.qty-control span{
font-weight:600;
min-width:20px;
text-align:center;
}

.category-dropdown{
position:relative;
}

.dropdown-btn{
display:flex;
align-items:center;
gap:6px;
}

.dropdown-menu{
position:absolute;
top:48px;
left:0;
min-width:200px;

background:rgba(20,30,50,0.9);
backdrop-filter:blur(60px);
border-radius:22px;
padding:8px;

border:1px solid rgba(255,255,255,0.08);

transform-origin:top;
transform:scaleY(0);
opacity:0;
transition:transform .35s cubic-bezier(.22,1,.36,1),
opacity .25s ease;

overflow:hidden;
}

.dropdown-menu.show{
transform:scaleY(1);
opacity:1;
}

.dropdown-menu div{
padding:12px 14px;
border-radius:14px;
cursor:pointer;
font-size:14px;
transition:.25s;
color:rgba(255,255,255,0.8);
}

.dropdown-menu div:hover{
background:linear-gradient(135deg,var(--accent),var(--accent2));
color:white;
}

.search-container{
padding:0 20px 20px;
position:sticky;
top:0;
z-index:50;
background:linear-gradient(180deg,#0e1627,#0e1627cc);
backdrop-filter:blur(20px);
}

#searchInput{
width:100%;
padding:14px 20px;
border-radius:30px;
border:1px solid rgba(255,255,255,0.08);
background:rgba(255,255,255,0.06);
color:white;
font-size:14px;
outline:none;
transition:.3s;
}

#searchInput:focus{
border:1px solid var(--accent);
box-shadow:0 0 20px rgba(79,156,255,0.3);
}

.checkout-summary{
margin-top:20px;
padding:16px;
border-radius:22px;
background:rgba(255,255,255,0.05);
border:1px solid rgba(255,255,255,0.08);
backdrop-filter:blur(20px);
}

.summary-row{
display:flex;
justify-content:space-between;
font-size:13px;
margin-bottom:8px;
opacity:.8;
}

.summary-divider{
height:1px;
background:rgba(255,255,255,0.1);
margin:10px 0;
}

.total-row{
font-weight:700;
font-size:15px;
opacity:1;
}

.order-history-section{
margin:40px 20px;
}

.history-card{
background:rgba(255,255,255,0.05);
border:1px solid rgba(255,255,255,0.08);
border-radius:22px;
padding:16px;
margin-bottom:16px;
backdrop-filter:blur(20px);
}

.history-header{
display:flex;
justify-content:space-between;
font-size:13px;
margin-bottom:8px;
opacity:.7;
}

.history-id{
font-weight:600;
color:#9ecbff;
}

.history-items{
font-size:13px;
margin-bottom:8px;
opacity:.8;
}

.history-total{
font-weight:700;
font-size:14px;
}

</style>
</head>
<body>

<div class="dynamic-island" id="island">‚òï Dhito Cafe</div>

<div class="hero">
  <div class="greeting" id="greeting"></div>
  <div class="headline">Siap nongki hari ini?</div>
</div>

<div class="search-container">
<input type="text" id="searchInput" placeholder="Cari menu favoritmu...">
</div>

<div class="categories">

<div class="category-dropdown">
  <button class="active dropdown-btn" onclick="toggleDropdown(event)">
    Semua ‚åÑ
  </button>

  <div class="dropdown-menu" id="categoryDropdown">
    <div onclick="selectCategory('all')">Semua</div>
    <div onclick="selectCategory('makanan')">üçõ Makanan</div>
    <div onclick="selectCategory('minuman')">‚òï Minuman</div>
    <div onclick="selectCategory('cemilan')">üçü Cemilan</div>
    <div onclick="selectCategory('promo')">üî• Promo</div>
  </div>
</div>

<button onclick="filterMenu('makanan',this)">Makanan</button>
<button onclick="filterMenu('minuman',this)">Minuman</button>
<button onclick="filterMenu('cemilan',this)">Cemilan</button>
<button onclick="filterMenu('promo',this)">Promo</button>

</div>

<div class="menu-grid" id="menu"></div>
<div class="loyalty">
  <div class="loyalty-text">Level Silver ü•à</div>
  <div class="loyalty-bar">
    <div class="loyalty-fill" id="loyaltyFill"></div>
  </div>
</div>
<div class="order-history-section">
  <h3 class="section-title">üßæ Riwayat Pesanan</h3>
  <div id="orderHistoryList"></div>
</div>
<div class="floating-cart" onclick="openSheet()">
üõí
<div class="cart-count" id="cartCount">0</div>
</div>

<div class="sheet" id="sheet">
<div class="handle"></div>

<h3>Detail Pesanan</h3>
<div id="cartItems"></div>
<div class="checkout-summary">
  <div class="summary-row">
    <span>Subtotal</span>
    <span id="subtotal"></span>
  </div>
  <div class="summary-row">
    <span>Service (5%)</span>
    <span id="service"></span>
  </div>
  <div class="summary-row">
    <span>Pajak (10%)</span>
    <span id="tax"></span>
  </div>

  <div class="summary-divider"></div>

  <div class="summary-row total-row">
    <span>Total</span>
    <span id="grandTotal"></span>
  </div>
</div>
<h4 id="total"></h4>

<hr style="margin:15px 0;border-color:rgba(255,255,255,0.1)">

<h3>Pembayaran</h3>
<input class="input" placeholder="Nama">
<input class="input" placeholder="No HP">
<select class="input">
<option>Metode Pembayaran</option>
<option>Cash</option>
<option>QRIS</option>
<option>Transfer</option>
</select>

<button class="checkout-btn" onclick="checkout()">Bayar Sekarang</button>
</div>

<div class="menu-modal" id="menuModal">
  <div class="menu-modal-content">
    <div class="menu-modal-img" id="modalImg"></div>
    <div class="menu-modal-body">
  <h2 id="modalTitle"></h2>
  <p id="modalDesc"></p>

  <div class="topping-section">
    <h4>Pilih Topping</h4>
    <div class="topping-list" id="toppingList"></div>
  </div>
<div class="modal-qty">
  <button onclick="decreaseModal()">‚àí</button>
  <span id="modalQty">1</span>
  <button onclick="increaseModal()">+</button>
</div>
  <div class="modal-price" id="modalPrice"></div>
  <button class="modal-add" id="modalAddBtn">Tambah ke Keranjang</button>
</div>
  </div>
</div>

<script>
const island=document.getElementById("island");
const menuEl=document.getElementById("menu");
const sheet=document.getElementById("sheet");
const cartCount=document.getElementById("cartCount");
const modal=document.getElementById("menuModal");
const modalImg=document.getElementById("modalImg");
const modalTitle=document.getElementById("modalTitle");
const modalDesc=document.getElementById("modalDesc");
const modalPrice=document.getElementById("modalPrice");
const modalAddBtn=document.getElementById("modalAddBtn");

function openMenuDetail(n){
let item=data.find(d=>d.nama===n);
selectedToppings=[];
modalQty=1;
document.getElementById("modalQty").innerText=modalQty;

modalImg.style.backgroundImage=`url('${item.img}')`;
modalTitle.innerText=item.nama;
modalDesc.innerText=item.desc;

renderToppings();
updatePrice(item);

modalAddBtn.onclick=()=>addToCartWithTopping(item);

modal.classList.add("show");
}

modal.addEventListener("click",(e)=>{
if(e.target===modal){
modal.classList.remove("show");
}
});

let cart=JSON.parse(localStorage.getItem("dhito_cart")||"[]");
let filter="all";
let selectedToppings=[];
let modalQty = 1;
let searchQuery="";
let orderHistory = JSON.parse(localStorage.getItem("order_history") || "[]");

document.getElementById("searchInput")
.addEventListener("input",(e)=>{
searchQuery=e.target.value.toLowerCase();
render();
});

window.addEventListener("scroll",()=>{

let sections=document.querySelectorAll(".menu-section");

sections.forEach(sec=>{
let rect=sec.getBoundingClientRect();

if(rect.top<=150 && rect.bottom>=150){

let id=sec.id.replace("section-","");

document.querySelectorAll(".categories button")
.forEach(b=>b.classList.remove("active"));

document.querySelectorAll(".categories button")
.forEach(btn=>{
if(btn.innerText.toLowerCase().includes(id)){
btn.classList.add("active");
}
});

}
});

});

const toppingsData = [
{nama:"Extra Keju",harga:5000},
{nama:"Telur Tambah",harga:6000},
{nama:"Sosis",harga:7000},
{nama:"Extra Shot Kopi",harga:8000},
{nama:"Whipped Cream",harga:4000}
];

const data=[
{nama:"Nasi Goreng",harga:25000,kategori:"makanan",img:"https://source.unsplash.com/600x400/?friedrice",desc:"Nasi goreng spesial dengan ayam, telur, dan bumbu rahasia Dhito Cafe."},

{nama:"Es Kopi",harga:18000,kategori:"minuman",img:"https://source.unsplash.com/600x400/?coffee",desc:"Cold brew creamy dengan gula aren premium, segar dan nikmat."},

{nama:"Kentang",harga:15000,kategori:"cemilan",img:"https://source.unsplash.com/600x400/?fries",desc:"Kentang goreng crispy dengan saus spesial pilihan."},

{nama:"Paket Hemat",harga:45000,kategori:"promo",img:"https://source.unsplash.com/600x400/?foodcombo",desc:"Combo nasi + minuman favorit dengan harga lebih hemat."}
];

function renderToppings(){
let list=document.getElementById("toppingList");
list.innerHTML="";

toppingsData.forEach(t=>{
list.innerHTML+=`
<div class="topping-item"
onclick="toggleTopping('${t.nama}')">
${t.nama} (+Rp ${t.harga.toLocaleString()})
</div>`;
});
}

function toggleDropdown(e){
e.stopPropagation();
document.getElementById("categoryDropdown").classList.toggle("show");
}

function selectCategory(k){

filter=k;
render();

document.querySelectorAll(".categories button")
.forEach(b=>b.classList.remove("active"));

document.querySelector(".dropdown-btn").classList.add("active");

document.getElementById("categoryDropdown").classList.remove("show");

notify(`üìÇ Kategori: ${k.toUpperCase()}`,"info");

/* auto scroll ke menu */
document.getElementById("menu")
.scrollIntoView({behavior:"smooth"});
}

/* close dropdown jika klik luar */
document.addEventListener("click",()=>{
document.getElementById("categoryDropdown").classList.remove("show");
});

function toggleTopping(nama){
let index=selectedToppings.findIndex(t=>t.nama===nama);
let topping=toppingsData.find(t=>t.nama===nama);

if(index>-1){
selectedToppings.splice(index,1);
}else{
selectedToppings.push(topping);
}

updateActiveUI();
updatePrice(data.find(d=>d.nama===modalTitle.innerText));
}

function updateActiveUI(){
document.querySelectorAll(".topping-item").forEach(el=>{
let nama=el.innerText.split(" (+")[0];
if(selectedToppings.find(t=>t.nama===nama)){
el.classList.add("active");
}else{
el.classList.remove("active");
}
});
}

function updatePrice(item){
let total=item.harga;

selectedToppings.forEach(t=>total+=t.harga);

total*=modalQty;

modalPrice.innerText="Total Rp "+total.toLocaleString();
}

function addToCartWithTopping(item){

let toppingText=selectedToppings.map(t=>t.nama).join(", ");
let finalName=item.nama;
if(toppingText){
finalName+=` (${toppingText})`;
}

let basePrice=item.harga;
selectedToppings.forEach(t=>basePrice+=t.harga);

let existing=cart.find(c=>c.nama===finalName);

if(existing){
existing.qty+=modalQty;
}else{
cart.push({
nama:finalName,
harga:basePrice,
qty:modalQty
});
}

notify(`‚úÖ ${finalName} (${modalQty}x)`,"success");

modal.classList.remove("show");
saveCart();
updateCart();
}

function increaseModal(){
modalQty++;
document.getElementById("modalQty").innerText=modalQty;
updatePrice(data.find(d=>d.nama===modalTitle.innerText));
}

function decreaseModal(){
if(modalQty>1){
modalQty--;
document.getElementById("modalQty").innerText=modalQty;
updatePrice(data.find(d=>d.nama===modalTitle.innerText));
}
}

function render(){

menuEl.innerHTML="";

let filtered=data.filter(d=>{
return (filter==="all"||d.kategori===filter) &&
(d.nama.toLowerCase().includes(searchQuery));
});

let grouped={};

filtered.forEach(item=>{
if(!grouped[item.kategori]) grouped[item.kategori]=[];
grouped[item.kategori].push(item);
});

Object.keys(grouped).forEach(kat=>{

menuEl.innerHTML+=`
<div class="menu-section" id="section-${kat}">
<h3 class="section-title">${kat.toUpperCase()}</h3>
<div class="menu-grid">
${grouped[kat].map(d=>`
<div class="card" onclick="openMenuDetail('${d.nama}')">
<img src="${d.img}">
<h4>${d.nama}</h4>
<div class="price">Rp ${d.harga.toLocaleString()}</div>
<button onclick="event.stopPropagation();openMenuDetail('${d.nama}')">
Tambah
</button>
</div>
`).join("")}
</div>
</div>
`;

});
}

function filterMenu(k,btn){
filter=k;
document.querySelectorAll(".categories button").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
render();
}

function setGreeting(){
let hour=new Date().getHours();
let greet="Selamat Datang";

if(hour<11) greet="Selamat Pagi ‚òÄÔ∏è";
else if(hour<15) greet="Selamat Siang üå§";
else if(hour<18) greet="Selamat Sore üåá";
else greet="Selamat Malam üåô";

document.getElementById("greeting").innerText=greet+", Dhito";
}

setGreeting();

function checkoutProgress(){

island.classList.remove("success","danger","warning","info");
island.classList.add("expand","payment");

island.innerHTML=`
üí≥ Memproses Pembayaran
<div class="island-status" id="payStatus">
Menghubungi gateway...
</div>
<div class="island-progress">
<div class="island-progress-bar" id="progressBar"></div>
</div>
`;

let bar=document.getElementById("progressBar");
let status=document.getElementById("payStatus");

let steps=[
{w:20, text:"Menghubungi gateway..."},
{w:45, text:"Verifikasi keamanan üîê"},
{w:70, text:"Menunggu konfirmasi bank..."},
{w:90, text:"Menyelesaikan transaksi..."},
{w:100, text:"Pembayaran berhasil ‚úÖ"}
];

let i=0;

let interval=setInterval(()=>{
bar.style.width=steps[i].w+"%";
status.innerText=steps[i].text;
i++;

if(i>=steps.length){
clearInterval(interval);

setTimeout(()=>{
island.classList.remove("payment");
island.classList.add("success");

let total=document.getElementById("total").innerText;

island.innerHTML=`
üéâ Pembayaran Sukses
<div class="island-status">${total}</div>
`;

confettiEffect();

setTimeout(()=>{
island.classList.remove("expand","success");
island.innerHTML="‚òï Dhito Cafe";
},2500);

},700 + Math.random()*600);
}

},700 + Math.random()*600);
}

function add(n){
let item=cart.find(i=>i.nama===n);
if(item){
item.qty++;
notify(`üîÑ ${n} (${item.qty}x)`,"info");
}else{
let d=data.find(x=>x.nama===n);
cart.push({...d,qty:1});
notify(`‚úÖ ${n} ditambahkan`,"success");
}
saveCart();
updateCart();
}

function updateCart(){

let subtotal=0;

document.getElementById("cartItems").innerHTML=
cart.map((i,idx)=>{
subtotal+=i.harga*i.qty;

return `
<div class="cart-item">
<div class="cart-item-info"
onclick="editCartItem(${idx})">

<span class="cart-item-name">${i.nama}</span>
<span class="cart-item-price">
Rp ${(i.harga*i.qty).toLocaleString()}
</span>

</div>

<div class="qty-control">
<button onclick="event.stopPropagation();decrease(${idx})">‚àí</button>
<span>${i.qty}</span>
<button onclick="event.stopPropagation();increase(${idx})">+</button>
</div>
</div>
`;
}).join("");

let service=subtotal*0.05;
let tax=subtotal*0.10;
let grand=subtotal+service+tax;

document.getElementById("subtotal").innerText="Rp "+subtotal.toLocaleString();
document.getElementById("service").innerText="Rp "+service.toLocaleString();
document.getElementById("tax").innerText="Rp "+tax.toLocaleString();
document.getElementById("grandTotal").innerText="Rp "+grand.toLocaleString();

cartCount.innerText=cart.reduce((a,b)=>a+b.qty,0);

}

function editCartItem(index){

let item=cart[index];

let baseName=item.nama.split(" (")[0];
let base=data.find(d=>d.nama===baseName);

selectedToppings=[];
modalQty=item.qty;

document.getElementById("modalQty").innerText=modalQty;

modalImg.style.backgroundImage=`url('${base.img}')`;
modalTitle.innerText=base.nama;
modalDesc.innerText=base.desc;

renderToppings();

/* restore topping */
let toppingText=item.nama.match(/\((.*?)\)/);
if(toppingText){
let toppingArr=toppingText[1].split(", ");
toppingArr.forEach(t=>{
let top=toppingsData.find(td=>td.nama===t);
if(top) selectedToppings.push(top);
});
}

updateActiveUI();
updatePrice(base);

modalAddBtn.innerText="Update Pesanan";

modalAddBtn.onclick=()=>{
updateCartItem(index,base);
};

modal.classList.add("show");
}

function updateCartItem(index,item){

let toppingText=selectedToppings.map(t=>t.nama).join(", ");
let finalName=item.nama;

if(toppingText){
finalName+=` (${toppingText})`;
}

let basePrice=item.harga;
selectedToppings.forEach(t=>basePrice+=t.harga);

cart[index]={
nama:finalName,
harga:basePrice,
qty:modalQty
};

modal.classList.remove("show");
modalAddBtn.innerText="Tambah ke Keranjang";

saveCart();
updateCart();

notify("‚úèÔ∏è Pesanan diperbarui","success");
}

function increase(i){
cart[i].qty++;
notify(`üîÑ ${cart[i].nama} (${cart[i].qty}x)`,"info");
saveCart();
updateCart();
}

function decrease(i){
let name = cart[i].nama;
cart[i].qty--;

if(cart[i].qty<=0){
cart.splice(i,1);
notify(`‚ùå ${name} dihapus`,"danger");
}else{
notify(`üîÑ ${name} (${cart[i].qty}x)`,"info");
}

saveCart();
updateCart();
}

function saveCart(){
localStorage.setItem("dhito_cart",JSON.stringify(cart));
}

function openSheet(){sheet.classList.add("show")}
function closeSheet(){sheet.classList.remove("show")}

/* CLOSE VIA HANDLE TAP */
document.querySelector(".handle").addEventListener("click",closeSheet);

/* SWIPE DOWN TO CLOSE */
let startY=0;
sheet.addEventListener("touchstart",e=>{
startY=e.touches[0].clientY;
});
sheet.addEventListener("touchmove",e=>{
let currentY=e.touches[0].clientY;
if(currentY-startY>120){
closeSheet();
}
});

function notify(text,type="info"){

island.classList.remove("success","info","danger","warning");
island.classList.add("expand",type);

island.style.opacity="0";
island.style.transform="translateX(-50%) scale(.8)";

setTimeout(()=>{
island.innerHTML=`${text}`;
island.style.opacity="1";
island.style.transform="translateX(-50%) scale(1.05)";
},120);

setTimeout(()=>{
island.classList.remove("expand",type);
island.innerHTML="‚òï Dhito Cafe";
island.style.transform="translateX(-50%) scale(1)";
},2500);
}

let points=parseInt(localStorage.getItem("dhito_points")||0);

function updateLoyalty(){
let percent=(points%100);
document.getElementById("loyaltyFill").style.width=percent+"%";
}

function confettiEffect(){
for(let i=0;i<40;i++){
let conf=document.createElement("div");
conf.style.position="fixed";
conf.style.width="6px";
conf.style.height="6px";
conf.style.background="white";
conf.style.top="50%";
conf.style.left="50%";
conf.style.opacity="0.8";
conf.style.borderRadius="50%";
conf.style.zIndex="9999";
conf.style.transform=`translate(${Math.random()*300-150}px,${Math.random()*300-150}px)`;
document.body.appendChild(conf);
setTimeout(()=>conf.remove(),800);
}
}

function renderHistory(){

let container=document.getElementById("orderHistoryList");

if(orderHistory.length===0){
container.innerHTML="<p style='opacity:.5;font-size:13px;'>Belum ada pesanan.</p>";
return;
}

container.innerHTML=orderHistory.map(order=>{

let items=order.items.map(i=>
`${i.nama} (${i.qty}x)`
).join("<br>");

return `
<div class="history-card">

<div class="history-header">
<span class="history-id">${order.id}</span>
<span>${order.date}</span>
</div>

<div class="history-items">
${items}
</div>

<div class="history-total">
Total: Rp ${order.total.toLocaleString()}
</div>

</div>
`;

}).join("");

}

function generateOrderNumber(){

let now=new Date();

let date=
String(now.getDate()).padStart(2,'0')+
String(now.getMonth()+1).padStart(2,'0')+
String(now.getFullYear()).slice(-2);

let random=Math.floor(1000+Math.random()*9000);

return "#ORD-"+date+"-"+random;
}

function checkout(){

/* ================= VALIDASI ================= */
let inputs=document.querySelectorAll(".input");
for(let i of inputs){
if(!i.value){
notify("‚ö†Ô∏è Lengkapi data dulu","warning");
return;
}
}

if(cart.length===0){
notify("Keranjang kosong","danger");
return;
}

/* ================= HITUNG TOTAL ================= */
let subtotal=0;
cart.forEach(i=>{
subtotal+=i.harga*i.qty;
});

let service=subtotal*0.05;
let tax=subtotal*0.10;
let grand=subtotal+service+tax;

/* ================= ORDER NUMBER ================= */
let orderNo=generateOrderNumber();

/* ================= SIMPAN HISTORY ================= */
let orderData={
id:orderNo,
date:new Date().toLocaleString(),
items:[...cart],
subtotal,
service,
tax,
total:grand
};

orderHistory.unshift(orderData);
localStorage.setItem("order_history",JSON.stringify(orderHistory));

/* ================= LOYALTY ================= */
points+=20;
localStorage.setItem("dhito_points",points);
updateLoyalty();

/* ================= UI EFFECT ================= */
closeSheet();
checkoutProgress();
confettiEffect();

notify("üéâ Order berhasil! "+orderNo,"success");

/* ================= RESET CART ================= */
cart=[];
saveCart();
updateCart();
renderHistory();
}



updateLoyalty();
updateCart();
renderHistory();
render();
</script>
</body>
</html>