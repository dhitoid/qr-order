<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dhito Cafe - Manual Order</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="daftarmenu.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif}

body{
background:linear-gradient(135deg,#0f172a,#1e293b);
color:white;
padding:20px;
}

/* ================= DYNAMIC NOTIF ================= */

.dynamic-island{
position:fixed;
top:20px;
left:50%;
transform:translateX(-50%) translateY(-120%);
background:rgba(0,0,0,0.75);
backdrop-filter:blur(25px);
padding:14px 20px;
border-radius:30px;
font-size:13px;
font-weight:600;
transition:.4s cubic-bezier(.68,-0.6,.32,1.6);
z-index:9999;
opacity:0;
}

.dynamic-island.show{
transform:translateX(-50%) translateY(0);
opacity:1;
}

/* ================= UI ================= */

h2{margin-bottom:15px}

.grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
gap:12px;
}

.menu-card{
background:rgba(255,255,255,0.07);
padding:14px;
border-radius:18px;
backdrop-filter:blur(15px);
display:flex;
flex-direction:column;
justify-content:space-between;
min-height:120px;
transition:.2s;
}

.menu-card:hover{
transform:scale(1.03);
}

.menu-card h4{
font-size:14px;
margin-bottom:6px;
}

.menu-card small{
opacity:.6;
font-size:12px;
}

.qty-control{
margin-top:10px;
display:flex;
justify-content:space-between;
align-items:center;
}

.qty-control button{
border:none;
background:#3b82f6;
color:white;
width:28px;
height:28px;
border-radius:8px;
cursor:pointer;
}

.cart-box{
margin-top:25px;
background:rgba(255,255,255,0.06);
padding:18px;
border-radius:20px;
backdrop-filter:blur(20px);
}

.cart-item{
display:flex;
justify-content:space-between;
font-size:13px;
margin-bottom:6px;
}

.total{
margin-top:12px;
font-weight:700;
font-size:15px;
}

.btn{
margin-top:12px;
width:100%;
padding:14px;
border:none;
border-radius:16px;
font-weight:600;
cursor:pointer;
}

.btn-primary{
background:#22c55e;
color:white;
}

.btn-secondary{
background:#ef4444;
color:white;
}

input{
width:100%;
padding:12px;
border-radius:12px;
border:none;
margin-top:5px;
font-size:14px;
}
</style>
</head>
<body>

<div class="dynamic-island" id="notif"></div>

<h2>➕ Manual Order (Walk In)</h2>

<div class="grid" id="menuGrid"></div>

<div class="cart-box">
<h3>Keranjang</h3>
<div id="cartItems"></div>

<div class="total" id="cartTotal">Total: Rp 0</div>

<div style="margin-top:15px">
<label style="font-size:13px;opacity:.7">Uang Bayar</label>
<input type="text" id="cashInput" placeholder="Masukkan nominal"
oninput="formatRupiah(this);calculateChange()">
</div>

<div style="margin-top:10px;font-weight:600" id="changeOutput">
Kembalian: Rp 0
</div>

<button class="btn btn-primary" onclick="processPayment()">
Bayar & Proses
</button>

<button class="btn btn-secondary" onclick="resetCart()">
Reset
</button>

<button class="btn" style="background:#3b82f6"
onclick="window.location.href='kasir.html'">
⬅ Kembali ke Menu Kasir
</button>
</div>

<script>

/* ================= DATA ================= */

let cart=[];
let lastTotal=0;

/* ================= NOTIF ================= */

function showNotif(text){
let notif=document.getElementById("notif");
notif.innerText=text;
notif.classList.add("show");

setTimeout(()=>{
notif.classList.remove("show");
},2500);
}

/* ================= FORMAT RUPIAH ================= */

function formatRupiah(input){
let number=input.value.replace(/\D/g,'');
input.value=new Intl.NumberFormat('id-ID').format(number);
}

function getCashValue(){
return parseInt(document.getElementById("cashInput").value.replace(/\D/g,''))||0;
}

/* ================= HITUNG ================= */

function calculateChange(){
let cash=getCashValue();
let change=cash-lastTotal;
let output=document.getElementById("changeOutput");

if(change<0){
output.innerText="Uang kurang: Rp "+Math.abs(change).toLocaleString();
output.style.color="#ef4444";
}else{
output.innerText="Kembalian: Rp "+change.toLocaleString();
output.style.color="#22c55e";
}
}

/* ================= PAYMENT ================= */

function processPayment(){

if(cart.length===0){
showNotif("Keranjang kosong ❌");
return;
}

let cash=getCashValue();
if(cash<lastTotal){
showNotif("Uang belum cukup ❌");
return;
}

showNotif("Memproses pembayaran...");

setTimeout(()=>{
saveOrder();
printStruk();
showNotif("Pembayaran berhasil ✅");
resetCart();
},1200);

}

/* ================= SAVE ORDER ================= */

function saveOrder(){

let subtotal=0;
cart.forEach(i=>subtotal+=i.harga*i.qty);

let service=subtotal*0.05;
let tax=subtotal*0.10;
let total=subtotal+service+tax;

let orders=JSON.parse(localStorage.getItem("order_history")||"[]");

orders.unshift({
id:"#ORD-"+Date.now(),
date:new Date().toLocaleString(),
items:[...cart],
subtotal,service,tax,total,
paymentStatus:"Lunas"
});

localStorage.setItem("order_history",JSON.stringify(orders));
}

/* ================= PRINT STRUK ================= */

function printStruk(){

let struk=`
=== DHITO CAFE ===
${new Date().toLocaleString()}
-----------------------
`;

cart.forEach(i=>{
struk+=`${i.nama} x${i.qty}
Rp ${(i.harga*i.qty).toLocaleString()}
`;
});

struk+=`
-----------------------
Total: Rp ${lastTotal.toLocaleString()}
Bayar: Rp ${getCashValue().toLocaleString()}
Kembali: Rp ${(getCashValue()-lastTotal).toLocaleString()}
=======================
Terima Kasih
`;

let win=window.open('','','width=300,height=600');
win.document.write('<pre>'+struk+'</pre>');
win.print();
win.close();

}

/* ================= MENU ================= */

function renderMenu(){
let container=document.getElementById("menuGrid");
container.innerHTML=MENU_DATA.map(item=>`
<div class="menu-card">
<div>
<h4>${item.nama}</h4>
<small>Rp ${item.harga.toLocaleString()}</small>
</div>
<div class="qty-control">
<button onclick="changeQty('${item.nama}',-1)">-</button>
<span id="qty-${item.nama.replace(/\s/g,'')}">0</span>
<button onclick="changeQty('${item.nama}',1)">+</button>
</div>
</div>
`).join("");
}

function changeQty(nama,delta){

let item=MENU_DATA.find(i=>i.nama===nama);
let existing=cart.find(c=>c.nama===nama);

if(!existing && delta>0){
cart.push({nama:item.nama,harga:item.harga,qty:1});
}else if(existing){
existing.qty+=delta;
if(existing.qty<=0){
cart=cart.filter(c=>c.nama!==nama);
}
}

updateQtyDisplay();
renderCart();
}

function updateQtyDisplay(){
MENU_DATA.forEach(item=>{
let el=document.getElementById("qty-"+item.nama.replace(/\s/g,''));
let found=cart.find(c=>c.nama===item.nama);
el.innerText=found?found.qty:0;
});
}

function renderCart(){

let container=document.getElementById("cartItems");

if(cart.length===0){
container.innerHTML="<small>Belum ada item</small>";
document.getElementById("cartTotal").innerText="Total: Rp 0";
lastTotal=0;
return;
}

let subtotal=0;

container.innerHTML=cart.map(i=>{
subtotal+=i.harga*i.qty;
return `<div class="cart-item">
<span>${i.nama} (${i.qty}x)</span>
<span>Rp ${(i.harga*i.qty).toLocaleString()}</span>
</div>`;
}).join("");

let service=subtotal*0.05;
let tax=subtotal*0.10;
let total=subtotal+service+tax;

lastTotal=total;
calculateChange();

document.getElementById("cartTotal")
.innerText="Total: Rp "+total.toLocaleString();
}

function resetCart(){
cart=[];
document.getElementById("cashInput").value="";
updateQtyDisplay();
renderCart();
}

/* INIT */
renderMenu();
renderCart();

</script>

</body>
</html>