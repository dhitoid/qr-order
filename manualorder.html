<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manual Order - Dhito Cafe</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<!-- ðŸ”¥ PAKAI CSS YANG SAMA -->
<link rel="stylesheet" href="menuorder.css">

<script src="daftarmenu.js"></script>
</head>
<body>

<div class="dynamic-island" id="island">
â˜• Manual Order
</div>

<div class="hero">
<div class="greeting">Mode Kasir</div>
<div class="headline">Manual Order</div>
</div>

<div class="menu-grid" id="menuGrid"></div>

<!-- FLOATING CART -->
<div class="floating-cart" onclick="openSheet()">
ðŸ›’
<div class="cart-count" id="cartCount">0</div>
</div>

<!-- SHEET -->
<div class="sheet" id="sheet">
<!-- QRIS POPUP -->
<div class="qris-popup" id="qrisPopup">
<div class="qris-box">
<h3>Pembayaran QRIS</h3>
<img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=DhitoCafeQRIS" />
<p id="qrisAmount"></p>

<button onclick="confirmPayment()">Saya Sudah Bayar</button>
<button class="btn-cancel" onclick="closeQRIS()">Batal</button>
</div>
</div>
<div class="handle"></div>

<h3>Detail Order</h3>

<input class="input" id="customerName" placeholder="Nama Pelanggan">
<input class="input" id="customerPhone" 
placeholder="08xxxxxxxxxx"
oninput="formatPhone(this)">

<select class="input" id="paymentMethod">
<option value="">Pilih Metode</option>
<option value="QRIS">QRIS</option>
<option value="KASIR">Bayar di Kasir</option>
</select>

<div id="cartItems"></div>

<div class="checkout-summary">
<div class="summary-row">
<span>Subtotal</span>
<span id="subtotal">Rp 0</span>
</div>

<div class="summary-row">
<span>Service</span>
<span id="service">Rp 0</span>
</div>

<div class="summary-row">
<span>Pajak</span>
<span id="tax">Rp 0</span>
</div>

<div class="summary-divider"></div>

<div class="summary-row total-row">
<span>Total</span>
<span id="grandTotal">Rp 0</span>
</div>
</div>

<button class="checkout-btn" onclick="createOrder()">
Buat Order
</button>

<br><br>

<button class="btn-secondary" onclick="backToKasir()">
â¬… Kembali ke Kasir
</button>

</div>

<script>

const kasirMenu = MENU_DATA;
let cart = [];
let island = document.getElementById("island");

function formatPhone(input){

let value = input.value.replace(/[^0-9]/g,'');

if(value.startsWith("0")){
value = "62"+value.substring(1);
}

input.value = value;
}

/* ================= RENDER MENU ================= */

function renderMenu(){
document.getElementById("menuGrid").innerHTML =
kasirMenu.map(item=>`
<div class="card">
<h4>${item.nama}</h4>
<div class="price">Rp ${item.harga.toLocaleString()}</div>
<button onclick="addItem('${item.nama}')">Tambah</button>
</div>
`).join("");
}

/* ================= ADD ITEM ================= */

function addItem(nama){

let item = kasirMenu.find(i=>i.nama===nama);
let existing = cart.find(c=>c.nama===nama);

if(existing){
existing.qty++;
}else{
cart.push({...item,qty:1});
}

updateCart();
notify("âœ… "+nama+" ditambahkan","success");
}

/* ================= UPDATE CART ================= */

function updateCart(){

let subtotal = 0;

document.getElementById("cartItems").innerHTML =
cart.map((i,idx)=>{
subtotal += i.harga*i.qty;
return `
<div class="cart-item">
<span>${i.nama} (${i.qty}x)</span>
<div class="qty-control">
<button onclick="decrease(${idx})">âˆ’</button>
<button onclick="increase(${idx})">+</button>
</div>
</div>
`;
}).join("");

let service = subtotal*0.05;
let tax = subtotal*0.10;
let grand = subtotal+service+tax;

document.getElementById("subtotal").innerText="Rp "+subtotal.toLocaleString();
document.getElementById("service").innerText="Rp "+service.toLocaleString();
document.getElementById("tax").innerText="Rp "+tax.toLocaleString();
document.getElementById("grandTotal").innerText="Rp "+grand.toLocaleString();
document.getElementById("cartCount").innerText=cart.reduce((a,b)=>a+b.qty,0);
}

/* ================= QTY ================= */

function increase(i){cart[i].qty++;updateCart();}
function decrease(i){
cart[i].qty--;
if(cart[i].qty<=0) cart.splice(i,1);
updateCart();
}

function finalizeOrder(){

let orders = JSON.parse(localStorage.getItem("order_history") || "[]");

orders.unshift(window.pendingOrder);

localStorage.setItem("order_history", JSON.stringify(orders));

// Reset
cart = [];
updateCart();

window.pendingOrder = null;

notify("ðŸŽ‰ Order berhasil dibuat","success");
}

/* ================= CREATE ORDER ================= */

function createOrder(){

// 1ï¸âƒ£ VALIDASI KERANJANG
if(cart.length === 0){
notify("Keranjang kosong","danger");
return;
}

// 2ï¸âƒ£ VALIDASI METODE
let method = document.getElementById("paymentMethod").value;
if(!method){
notify("Pilih metode pembayaran","warning");
return;
}

// 3ï¸âƒ£ HITUNG TOTAL
let subtotal = 0;
cart.forEach(i => subtotal += i.harga * i.qty);

let service = subtotal * 0.05;
let tax     = subtotal * 0.10;
let total   = subtotal + service + tax;

// 4ï¸âƒ£ AMBIL DATA CUSTOMER
let customerName  = document.getElementById("customerName").value || "Walk In";
let customerPhone = document.getElementById("customerPhone").value || "-";

// 5ï¸âƒ£ VALIDASI NOMOR (JIKA QRIS)
if(method === "QRIS" && customerPhone === "-"){
notify("Nomor HP wajib untuk QRIS","warning");
return;
}

// 6ï¸âƒ£ SIMPAN KE PENDING (BELUM DISAVE)
window.pendingOrder = {
id:"#ORD-"+Date.now(),
date:new Date().toLocaleString(),
timestamp:Date.now(),
items:[...cart],
subtotal,
service,
tax,
total,
paymentMethod:method,
paymentStatus: method === "QRIS" ? "Menunggu Pembayaran" : "Lunas",
orderStatus:"Menunggu",
customerName,
customerPhone
};

// 7ï¸âƒ£ JIKA QRIS â†’ TAMPILKAN POPUP
if(method === "QRIS"){

document.getElementById("qrisAmount")
.innerText = "Total: Rp " + total.toLocaleString();

document.getElementById("qrisPopup")
.classList.add("show");

notify("Scan QR untuk pembayaran","warning");

return;
}

// 8ï¸âƒ£ JIKA BAYAR DI KASIR â†’ LANGSUNG SIMPAN
finalizeOrder();

}

function saveOrder(status){

let data = window.pendingOrder || {};

let orders=JSON.parse(localStorage.getItem("order_history")||"[]");

orders.unshift({
id:"#ORD-"+Date.now(),
date:new Date().toLocaleString(),
timestamp:Date.now(),
items:data.cart || cart,
subtotal:data.subtotal,
service:data.service,
tax:data.tax,
total:data.total,
paymentMethod:document.getElementById("paymentMethod").value,
paymentStatus:status,
orderStatus:"Diproses",
customerName:data.customerName,
customerPhone:data.customerPhone
});

localStorage.setItem("order_history",JSON.stringify(orders));

cart=[];
updateCart();
closeQRIS();

notify("ðŸ’³ Pembayaran Berhasil","success");
}

function confirmPayment(){

window.pendingOrder.paymentStatus = "Lunas";
window.pendingOrder.orderStatus = "Diproses";

finalizeOrder();

closeQRIS();

notify("ðŸ’³ Pembayaran Berhasil","success");
}

function closeQRIS(){
document.getElementById("qrisPopup").classList.remove("show");
}

/* ================= NOTIFY ================= */

function notify(text,type){

island.className="dynamic-island expand "+type;
island.innerText=text;

setTimeout(()=>{
island.className="dynamic-island";
island.innerText="â˜• Manual Order";
},2500);

}

/* ================= NAVIGATION ================= */

function openSheet(){
document.getElementById("sheet").classList.add("show");
}

function backToKasir(){
window.location.href="kasir.html";
}

renderMenu();
updateCart();

</script>

</body>
</html>