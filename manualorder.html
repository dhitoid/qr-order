<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Dhito Cafe - Manual Order</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="daftarmenu.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif}

body{
background:linear-gradient(135deg,#0f172a,#1e293b);
color:white;
padding:20px;
}

/* ===== Dynamic Island Advanced ===== */
.island{
position:fixed;
top:15px;
left:50%;
transform:translateX(-50%) translateY(-30px);
background:rgba(0,0,0,0.85);
backdrop-filter:blur(25px);
padding:14px 22px;
border-radius:35px;
font-weight:600;
opacity:0;
transition:.4s cubic-bezier(.77,0,.18,1);
z-index:9999;
min-width:220px;
text-align:center;
}

.island.show{
opacity:1;
transform:translateX(-50%) translateY(0);
}

.progress-bar{
margin-top:8px;
height:6px;
background:rgba(255,255,255,0.2);
border-radius:10px;
overflow:hidden;
}

.progress-fill{
height:100%;
width:0%;
background:#22c55e;
transition:width .3s ease;
}

/* ===== Menu Grid ===== */
.grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
gap:14px;
margin-top:50px;
}

.menu-card{
background:rgba(255,255,255,0.06);
padding:14px;
border-radius:20px;
backdrop-filter:blur(20px);
transition:.3s;
}
.menu-card:hover{
transform:translateY(-3px);
}

.menu-card h4{font-size:14px}
.menu-card small{opacity:.6;font-size:12px}

.qty{
display:flex;
justify-content:space-between;
margin-top:10px;
}
.qty button{
background:#3b82f6;
border:none;
color:white;
width:28px;
height:28px;
border-radius:8px;
}

/* ===== Cart ===== */
.cart{
margin-top:30px;
background:rgba(255,255,255,0.06);
padding:20px;
border-radius:25px;
backdrop-filter:blur(25px);
box-shadow:0 10px 30px rgba(0,0,0,.3);
}

.cart-item{
display:flex;
justify-content:space-between;
font-size:13px;
margin-bottom:6px;
}

.total{
margin-top:10px;
font-weight:700;
font-size:15px;
}

/* ===== Payment UI ===== */
.cash-input{
margin-top:15px;
}

.cash-input input{
width:100%;
padding:12px;
border-radius:14px;
border:none;
outline:none;
font-size:14px;
background:rgba(255,255,255,0.1);
color:white;
}

.quick{
display:flex;
gap:8px;
margin-top:10px;
flex-wrap:wrap;
}
.quick button{
padding:6px 10px;
border:none;
border-radius:12px;
background:#334155;
color:white;
font-size:12px;
}

.change{
margin-top:10px;
font-weight:600;
}

.btn{
margin-top:15px;
width:100%;
padding:14px;
border:none;
border-radius:18px;
font-weight:600;
cursor:pointer;
}

.pay{background:#22c55e;color:white}
.unpaid{background:#f59e0b;color:black}
.reset{background:#ef4444;color:white}

/* ===== Apple Style Success ===== */
.success{
position:fixed;
inset:0;
display:flex;
justify-content:center;
align-items:center;
background:rgba(0,0,0,.6);
backdrop-filter:blur(10px);
opacity:0;
pointer-events:none;
transition:.4s ease;
}

.success.show{
opacity:1;
pointer-events:auto;
}

.success-card{
background:rgba(255,255,255,0.08);
backdrop-filter:blur(30px);
padding:40px 50px;
border-radius:30px;
text-align:center;
transform:scale(.8);
opacity:0;
transition:.4s cubic-bezier(.34,1.56,.64,1);
}

.success.show .success-card{
transform:scale(1);
opacity:1;
}

.check{
width:90px;
height:90px;
border-radius:50%;
background:linear-gradient(135deg,#22c55e,#16a34a);
display:flex;
justify-content:center;
align-items:center;
font-size:45px;
margin:auto;
box-shadow:0 10px 40px rgba(34,197,94,.6);
animation:pop .5s ease;
}

@keyframes pop{
0%{transform:scale(.5)}
60%{transform:scale(1.2)}
100%{transform:scale(1)}
}

.success-text{
margin-top:15px;
font-size:15px;
font-weight:600;
opacity:.9;
}
</style>
</head>
<body>

<div class="island" id="island"></div>

<h2>‚òïÔ∏è Menu Order (Walk In)</h2>

<div class="grid" id="menuGrid"></div>

<div class="cart">
<h3>Keranjang</h3>
<div id="cartItems"></div>
<div class="total" id="totalText">Total: Rp 0</div>

<div class="cash-input">
<input id="customerName" placeholder="Nama Konsumen (Opsional)">
<input id="cashInput" placeholder="Masukkan uang bayar" oninput="formatCash()">
</div>

<div class="quick">
<button onclick="setNominal(10000)">10k</button>
<button onclick="setNominal(20000)">20k</button>
<button onclick="setNominal(50000)">50k</button>
<button onclick="setNominal(100000)">100k</button>
<button onclick="setNominal(lastTotal)">Uang Pas</button>
</div>

<div class="change" id="changeText">Kembalian: Rp 0</div>

<button class="btn pay" onclick="processPayment(true)">Bayar & Lunas</button>
<button class="btn unpaid" onclick="processPayment(false)">Buat (Belum Lunas)</button>
<button class="btn reset" onclick="resetCart()">Reset</button>
<button class="btn" style="background:#3b82f6;color:white" onclick="window.location.href='kasir.html'">Kembali ke Menu Kasir</button>
</div>

<div class="success" id="success">
  <div class="success-card">
    <div class="check">‚úì</div>
    <div class="success-text" id="successText">
      Pembayaran Berhasil
    </div>
  </div>
</div>

<script>
let cart=[];
let lastTotal=0;

/* ===== Island Advanced ===== */
function showIsland(message, showProgress=false){

let island=document.getElementById("island");

if(showProgress){
island.innerHTML=`
<div>${message}</div>
<div class="progress-bar">
<div class="progress-fill" id="progressFill"></div>
</div>
`;
}else{
island.innerHTML=message;
}

island.classList.add("show");
}

function hideIsland(){
setTimeout(()=>{
document.getElementById("island").classList.remove("show");
},800);
}

/* ===== Menu ===== */
function renderMenu(){
let grid=document.getElementById("menuGrid");
grid.innerHTML=MENU_DATA.map(item=>`
<div class="menu-card">
<h4>${item.nama}</h4>
<small>Rp ${item.harga.toLocaleString()}</small>
<div class="qty">
<button onclick="changeQty('${item.nama}',-1)">-</button>
<span id="q-${item.nama.replace(/\s/g,'')}">0</span>
<button onclick="changeQty('${item.nama}',1)">+</button>
</div>
</div>
`).join("");
}

function changeQty(nama,d){
let item=MENU_DATA.find(i=>i.nama===nama);
let ex=cart.find(c=>c.nama===nama);
if(!ex&&d>0)cart.push({nama:item.nama,harga:item.harga,qty:1});
else if(ex){
ex.qty+=d;
if(ex.qty<=0)cart=cart.filter(c=>c.nama!==nama);
}
updateQty();
renderCart();
}

function updateQty(){
MENU_DATA.forEach(i=>{
let el=document.getElementById("q-"+i.nama.replace(/\s/g,''));
let f=cart.find(c=>c.nama===i.nama);
el.innerText=f?f.qty:0;
});
}

/* ===== Cart ===== */
function renderCart(){
let el=document.getElementById("cartItems");
if(cart.length===0){
el.innerHTML="Belum ada item";
document.getElementById("totalText").innerText="Total: Rp 0";
return;
}
let sub=0;
el.innerHTML=cart.map(i=>{
sub+=i.harga*i.qty;
return `<div class="cart-item">
<span>${i.nama} (${i.qty}x)</span>
<span>Rp ${(i.harga*i.qty).toLocaleString()}</span>
</div>`;
}).join("");
let service=sub*0.05;
let tax=sub*0.10;
lastTotal=sub+service+tax;
document.getElementById("totalText")
.innerText="Total: Rp "+lastTotal.toLocaleString();
calculateChange();
}

/* ===== Format Rupiah ===== */
function formatCash(){
let input=document.getElementById("cashInput");
let num=input.value.replace(/\D/g,"");
input.value=num? "Rp "+parseInt(num).toLocaleString():"";
calculateChange();
}
function getCash(){
return parseInt(document.getElementById("cashInput")
.value.replace(/\D/g,""))||0;
}
function setNominal(val){
document.getElementById("cashInput")
.value="Rp "+val.toLocaleString();
calculateChange();
}

/* ===== Change ===== */
function calculateChange(){
let cash=getCash();
let change=cash-lastTotal;
let el=document.getElementById("changeText");
if(change<0){
el.innerText="Uang kurang: Rp "+Math.abs(change).toLocaleString();
el.style.color="#ef4444";
}else{
el.innerText="Kembalian: Rp "+change.toLocaleString();
el.style.color="#22c55e";
}
}

/* ===== Storage ===== */
function getOrders(){
return JSON.parse(localStorage.getItem("order_history")||"[]");
}
function saveOrders(d){
localStorage.setItem("order_history",JSON.stringify(d));
}

/* ===== Payment Process ===== */
function processPayment(paid){

if(cart.length===0){
showIsland("Keranjang kosong");
hideIsland();
return;
}

if(paid && getCash()<lastTotal){
showIsland("Uang belum cukup");
hideIsland();
return;
}

showIsland("Memproses pembayaran...",true);

let progress=0;
let interval=setInterval(()=>{

progress+=20;

let fill=document.getElementById("progressFill");
if(fill) fill.style.width=progress+"%";

if(progress>=100){

clearInterval(interval); // üî• STOP interval

let customer=document.getElementById("customerName").value || "Walk In";

/* ===== SAVE ORDER SEKALI SAJA ===== */
let orders=getOrders();
orders.unshift({
id:"#ORD-"+Date.now(),
date:new Date().toLocaleString(),
timestamp:Date.now(),
items:[...cart],
subtotal:lastTotal,
service:0,
tax:0,
total:lastTotal,
paymentMethod:"KASIR",
paymentStatus:paid?"Lunas":"Belum Lunas",
orderStatus:paid?"Diproses":"Menunggu",
customerName:customer,
customerPhone:"-"
});
saveOrders(orders);

/* ===== SUCCESS UI ===== */
if(paid){

document.getElementById("successText")
.innerText="Pembayaran berhasil\n"+customer;

document.getElementById("success").classList.add("show");

setTimeout(()=>{
document.getElementById("success").classList.remove("show");
},1600);

showIsland("Transaksi sukses ‚Ä¢ "+customer);

}else{
showIsland("Order dibuat ‚Ä¢ "+customer);
}

/* ===== HIDE ISLAND ===== */
setTimeout(()=>{
document.getElementById("island").classList.remove("show");
},1500);

/* ===== RESET CART ===== */
setTimeout(()=>{
resetCart();
},500);

}

},250);
}

/* ===== Reset ===== */
function resetCart(){
cart=[];
document.getElementById("customerName").value="";
document.getElementById("cashInput").value="";
updateQty();
renderCart();
}

renderMenu();
renderCart();
</script>

</body>
</html>