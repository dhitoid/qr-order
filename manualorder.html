<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dhito Cafe - Manual Order</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="daftarmenu.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif}

body{
background:linear-gradient(135deg,#0f172a,#1e293b);
color:white;
padding:20px;
}

h2{margin-bottom:15px}

.grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
gap:12px;
}

.menu-card{
background:rgba(255,255,255,0.07);
padding:14px;
border-radius:18px;
backdrop-filter:blur(15px);
display:flex;
flex-direction:column;
justify-content:space-between;
min-height:120px;
}

.menu-card h4{
font-size:14px;
margin-bottom:6px;
}

.menu-card small{
opacity:.6;
font-size:12px;
}

.qty-control{
margin-top:10px;
display:flex;
justify-content:space-between;
align-items:center;
}

.qty-control button{
border:none;
background:#3b82f6;
color:white;
width:28px;
height:28px;
border-radius:8px;
cursor:pointer;
}

.cart-box{
margin-top:25px;
background:rgba(255,255,255,0.06);
padding:18px;
border-radius:20px;
backdrop-filter:blur(20px);
}

.cart-item{
display:flex;
justify-content:space-between;
font-size:13px;
margin-bottom:6px;
}

.total{
margin-top:12px;
font-weight:700;
}

.btn{
margin-top:15px;
width:100%;
padding:14px;
border:none;
border-radius:16px;
font-weight:600;
cursor:pointer;
}

.btn-primary{
background:#4CAF50;
color:white;
}

.btn-secondary{
background:#ef4444;
color:white;
margin-top:8px;
}
</style>
</head>
<body>

<h2>➕ Manual Order (Walk In)</h2>

<div class="grid" id="menuGrid"></div>

<div class="cart-box">
<h3>Keranjang</h3>
<div id="cartItems"></div>

<div class="total" id="cartTotal">Total: Rp 0</div>

<div style="margin-top:15px">
<label style="font-size:13px;opacity:.7">Uang Bayar</label>
<input type="number" id="cashInput"
placeholder="Masukkan uang bayar"
oninput="calculateChange()"
style="width:100%;padding:10px;border-radius:12px;border:none;margin-top:5px">
</div>

<div style="margin-top:10px;font-weight:600" id="changeOutput">
Kembalian: Rp 0
</div>

<button class="btn btn-primary" onclick="createOrder(false)">
Buat Order (Belum Lunas)
</button>

<button class="btn btn-primary" style="background:#22c55e"
onclick="createOrder(true)">
Bayar & Lunas
</button>

<button class="btn btn-secondary" onclick="resetCart()">
Reset
</button>
</div>

<button class="btn btn-primary" onclick="createOrder()">
Buat Order
</button>

<button class="btn btn-secondary" onclick="resetCart()">
Reset
</button>
</div>

<script>

/* ================= DATA ================= */

let cart = [];
let lastTotal = 0;

function calculateChange(){

let cash = parseInt(document.getElementById("cashInput").value) || 0;

let change = cash - lastTotal;

let output = document.getElementById("changeOutput");

if(change < 0){
output.innerText = "Uang kurang: Rp " + Math.abs(change).toLocaleString();
output.style.color = "#ef4444";
}else{
output.innerText = "Kembalian: Rp " + change.toLocaleString();
output.style.color = "#22c55e";
}

}

function createOrder(markAsPaid){

if(cart.length===0){
alert("Keranjang kosong");
return;
}

let subtotal=0;
cart.forEach(i=>subtotal+=i.harga*i.qty);

let service=subtotal*0.05;
let tax=subtotal*0.10;
let total=subtotal+service+tax;

lastTotal = total;

if(markAsPaid){

let cash = parseInt(document.getElementById("cashInput").value) || 0;

if(cash < total){
alert("Uang belum cukup!");
return;
}

}

let orders=getOrders();

orders.unshift({
id:"#ORD-"+Date.now(),
date:new Date().toLocaleString(),
timestamp:Date.now(),
items:[...cart],
subtotal,
service,
tax,
total,
paymentMethod:"KASIR",
paymentStatus: markAsPaid ? "Lunas" : "Belum Lunas",
orderStatus: markAsPaid ? "Diproses" : "Menunggu",
customerName:"Walk In",
customerPhone:"-"
});

saveOrders(orders);

alert(markAsPaid ? "Pembayaran berhasil & order masuk kasir ✅"
: "Order dibuat (Belum Lunas)");

resetCart();
document.getElementById("cashInput").value="";
document.getElementById("changeOutput").innerText="Kembalian: Rp 0";

}

/* ================= RENDER MENU ================= */

function renderMenu(){

let container = document.getElementById("menuGrid");

container.innerHTML = MENU_DATA.map(item => `
<div class="menu-card">
<div>
<h4>${item.nama}</h4>
<small>Rp ${item.harga.toLocaleString()}</small>
</div>

<div class="qty-control">
<button onclick="changeQty('${item.nama}',-1)">-</button>
<span id="qty-${item.nama.replace(/\s/g,'')}">0</span>
<button onclick="changeQty('${item.nama}',1)">+</button>
</div>
</div>
`).join("");

}

function changeQty(nama,delta){

let item = MENU_DATA.find(i=>i.nama===nama);
let existing = cart.find(c=>c.nama===nama);

if(!existing && delta>0){
cart.push({nama:item.nama,harga:item.harga,qty:1});
}else if(existing){
existing.qty += delta;
if(existing.qty<=0){
cart = cart.filter(c=>c.nama!==nama);
}
}

updateQtyDisplay();
renderCart();
}

function updateQtyDisplay(){
MENU_DATA.forEach(item=>{
let el=document.getElementById("qty-"+item.nama.replace(/\s/g,''));
let found=cart.find(c=>c.nama===item.nama);
el.innerText=found?found.qty:0;
});
}

/* ================= CART ================= */

function renderCart(){

let container=document.getElementById("cartItems");

if(cart.length===0){
container.innerHTML="<small>Belum ada item</small>";
document.getElementById("cartTotal").innerText="Total: Rp 0";
return;
}

let subtotal=0;

container.innerHTML=cart.map(i=>{
subtotal+=i.harga*i.qty;
return `<div class="cart-item">
<span>${i.nama} (${i.qty}x)</span>
<span>Rp ${(i.harga*i.qty).toLocaleString()}</span>
</div>`;
}).join("");

let service=subtotal*0.05;
let tax=subtotal*0.10;
let total=subtotal+service+tax;

lastTotal = total;
calculateChange();

document.getElementById("cartTotal")
.innerText="Total: Rp "+total.toLocaleString();
}

/* ================= STORAGE ================= */

function getOrders(){
return JSON.parse(localStorage.getItem("order_history")||"[]");
}

function saveOrders(data){
localStorage.setItem("order_history",JSON.stringify(data));
}

/* ================= CREATE ORDER ================= */

function createOrder(){

if(cart.length===0){
alert("Keranjang kosong");
return;
}

let subtotal=0;
cart.forEach(i=>subtotal+=i.harga*i.qty);

let service=subtotal*0.05;
let tax=subtotal*0.10;
let total=subtotal+service+tax;

let orders=getOrders();

orders.unshift({
id:"#ORD-"+Date.now(),
date:new Date().toLocaleString(),
timestamp:Date.now(),
items:[...cart],
subtotal,
service,
tax,
total,
paymentMethod:"KASIR",
paymentStatus:"Belum Lunas",
orderStatus:"Menunggu",
customerName:"Walk In",
customerPhone:"-"
});

saveOrders(orders);

alert("Order berhasil dibuat & masuk ke kasir ✅");

resetCart();
}

function resetCart(){
cart=[];
updateQtyDisplay();
renderCart();
}

/* INIT */
renderMenu();
renderCart();

</script>

</body>
</html>